pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

playname={"rock","paper","scissors"}
gamestate=1          
stateplay=2
stateshoot=3
state2player=4
statetitle=5
stateend=6
t=0
shooting=false
winner=""


function _init()
 multiplay=false
 player1= {
            turn=1,
            shot=false,
            score=0
           }
 player2= {
            turn=1,
            shot=false,
            score=0
           }
 cpu= {
            turn=1,
            score=0
           }
 c=0
 bp=-1
 wn=-1
 turns={player1.turn,player2.turn}
 players={player1,player2}
 gamestate=statetitle 
 end

function cpuplay()
 return flr(rnd(3))+1
end


--tick then false for 20 tick then false for 20
function timer()
 local tick = true
 t-=1
 if t>0 then
  tick=false
 else
  tick=true
  t=30
 end
 return tick
end

function shoot()
 if timer() then
  c+=1
 end
 if player1.turn==1 then 
  wn=2
 elseif player1.turn==2 then
  wn=3
 elseif player1.turn==3 then
  wn=1
 end
 if c > 3 then
  play(wn)
  c=0
  t=0
  player1.shot=false
  player2.shot=false
  shooting=false
  gamestate=multiplay and state2player or stateplay
 end
end

function draw_title()
 print("z for 1 player",35,0)
 print("x for 2 player",35,10)
 print("player 2",10,80)
 print("controls",10,86)
 spr(9,10,95)
 spr(7,22,95)
 spr(8,35,95)
 print("s",11,105)
 print("f",23,105)
 print("e",37,105)
 print("player 1", 85,80)
 print("controls",85,86)
 spr(9,85,95)
 spr(7,97,95)
 spr(8,109,95)
 print("⬅️",85,105)
 print("⬆️",97,105)
 print("➡️",109,105)
end

function draw_play()
 if t>15 and c>=1 then
  spr(1,4,32)
  spr(1,50,32,1,1,1)
 elseif c==0 then 
  if not player2.shot then
   spr(player2.turn,4,32)
  end
  if not player1.shot then
   spr(player1.turn,50,32,1,1,1)
  end
 end
 if multiplay then
  if player1.shot and c==0 then
   print("ready",42,36,3)
  end 
  if player2.shot and c==0 then
   print("ready",0,36,3)
  end 
 end
end

function play(w)
 if player1.turn^^player2.turn==w then
  player1.score+=1
 elseif player2.turn != player1.turn then
  player2.score+=1
 end
end

function read_input(pl)
 checkscore()
 if not players[pl+1].shot then
  for i=0,2 do
   if btnp(i,pl) then
    shooting=true
    players[pl+1].shot=true
    if i==0 then
     turns[pl+1]=1
    elseif i==1 then 
     turns[pl+1]=3
    else
     turns[pl+1]=i
    end
    players[pl+1].turn=turns[pl+1]
   end
  end
 end
 if player1.shot and player2.shot then
  if timer() then
   if player1.score>=1 then
    gamestate=statetitle
   else 
    gamestate=stateshoot 
   end
  end
 end
end

function checkscore()
 if player1.score>=1 then
  winner="player one"
  gamestate=stateend
 end
 if player2.score>=1 then
  if multiplay then
   winner="player two"
  else 
   winner="cpu "
  end
  gamestate=stateend
 end
end

function singleplay()
 checkscore()
 for i=0,2 do
  if btnp(i) then
   player1.shot=true
   if i==0 then
    player1.turn=1
   elseif i == 1 then 
    player1.turn=3
   else
    player1.turn = i
   end
   player2.shot=true
   player2.turn=cpuplay()
   gamestate=stateshoot 
  end
 end
end

function title()
 _init()
 if btnp(4) then
  gamestate=stateplay
 elseif
  btnp(5) then
   multiplay=true
   gamestate=state2player
  end
end

function gameover()
 if btn(0) then
  gamestate=statetitle
 end
end

function draw_gameover()
 print("game over",5,20)
 print(winner,5,28)
 print("wins",5,36)
end

function _update()
 if gamestate==statetitle then
  title()
 elseif gamestate==stateplay then
  singleplay()
 elseif gamestate==state2player then
  --poke (24364,3)
  read_input(0)
  read_input(1)
 elseif gamestate==stateshoot then
  shoot()
 elseif gamestate==stateend then
  gameover()
 end
end
 
function _draw()
 cls(2)
 if gamestate!=statetitle then
  print (player2.score,5,0,7)
  print (player1.score,53,0)
 end
 if gamestate==statetitle then
  draw_title()
 elseif gamestate==stateend then
  draw_gameover()
 else
  draw_play()
 end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000d0000000000d0000000000000000000000000000d0000000000d0000000000000000000000000000000000000000000000000000000000
0070070000dd00000d0000000000d0000000000000000000000000000d0000000000d00000dd0000000000000000000000000000000000000000000000000000
000770000dddd0000dddddd00ddd00000000000000000000000000000dddddd00ddd00000dddd000000000000000000000000000000000000000000000000000
00077000dddd0000ddd00000ddd00000000000000000000000000000ddd00000ddd00000dddd0000000000000000000000000000000000000000000000000000
00700700ddddd000ddddddd0ddddddd0000000000000000000000000ddddddd0ddddddd0ddddd000000000000000000000000000000000000000000000000000
00000000dddd0000ddd00000dddd0000dd000000000000dddddddd00ddd00000dddd0000dddd0000000000000000000000000000000000000000000000000000
0000000000ddd0000ddddd000dd000001d00000000000d111d0000000ddddd000dd0000000ddd000000000000000000000000000000000000000000000000000
00000000dddddd111ddddddddddddd111d000000dddddd111dddddd0000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111011111111110000001111111111000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111100000011111111110000001111111111dddd00000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000111100000000000011110000000000001111000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
77777777777777777777777777777777777777777000000d7777777777777777777760055d777777777500000777777777777777777777777777777777777770
77777777777770000000000077777777777777700000000005777777777777777700000000777777700000000005777777000007777600000077777777777770
77777777777770000000000006777777777770000000000000077777777777777000000000777771000000000000077777000007777000000777777777777770
777777777777700000000000006777777777000000000000000077777777777d0000000007777700000000000000077777000007770000006777777777777770
777777777777700000000000000777777775000000000000000007777777777000000000077776000000000000007777770000077000000d7777777777777770
777777777777700000665000000177777770000000577d0000000077777777000000000007777000000067700007777777000007000000077777777777777770
77777777777770000077777000007777770000001777777d0000007777777600000077776777500000d777777077777777000005000000777777777777777770
777777777777700000777770000077777700000077777777d00000d7777770000007777777770000057777777777777777000000000007777777777777777770
77777777777770000077777d00007777770000077777777770000007777770000077777777770000077777777777777777000000000077777777777777777770
77777777777770000077777000007777750000077777777777000007777770000077777777760000577777777777777777000000000777777777777777777770
77777777777770000077770000017777700000d77777777777000007777770000077777777750000777777777777777777000000007777777777777777777770
77777777777770000000000000077777700000d777777777770000077777700000777777777d0000777777777777777777000000000777777777777777777770
77777777777770000000000000577777700000077777777777000007777770000077777777770000077777777777777777000000000077777777777777777770
777777777777700000000000057777777700000777777777700000077777700000777777777700000777777777777777770000000000d7777777777777777770
77777777777770000000000077777777770000007777777750000077777770000007777777770000007777777707777777000000000007777777777777777770
77777777777770000000000077777777770000001777777600000077777777000000777707775000000777776000777777000007000000777777777777777770
77777777777770000070000057777777777000000007750000000677777777000000000007777000000000000000077777000007700000077777777777777770
77777777777770000076000007777777777500000000000000000777777777700000000000777700000000000000007777000007760000007777777777777770
77777777777770000077000001777777777700000000000000007777777777770000000000777760000000000000077777000007770000000777777777777770
77777777777770000577700000777777777771000000000000077777777777777000000000077777000000000000777777000007777000000577777777777770
77777777777770000577700000077777777777700000000007777777777777777770000000d77777750000000077777777000007777700000077777777777770
77777777777777777777777777777777777777777000000777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777706666667777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777775666677777777777766666677777777777777777777777777777777777777777770
7777777777777777777777777777777777777777777777777777777777777166666f777777777066666677777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777776166666eeeef7777166666777777777777777777777777777777777777777777770
7777777777777777777777777777777777777777777777777777777777fee6166666eeeeeeef7666666777777777777777777777777777777777777777777770
7777777777777777777777777777777777777777777777777777feeeeeeeee6166666eeeeee70666667777777777777777777777777777777777777777777770
777777777777777777777777777777777777777777777777feeeeeeeeeeeee6166666eeeeee75666667777777777777777777777777777777777777777777770
7777777777777777777777777777777777777777777777eeeeeeeeeeeeeeeee6166666eeeee06666667777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeef1666666eee7066666eee77777777777777777777777777777777777777777770
777777777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeee6166666eee6666666eeee7777777777777777777777777777777777777777770
77777777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeee61666666ee066666eeeeee777777777777777777777777777777777777777770
777777777777777777777777777777777777777feeeeeeeeeeeeeeeeeeeeeeeee6166666e7666666eeeeeee77777777777777777777777777777777777777770
77777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeee706666660666666eeeeeeeef777777777777777777777777777777777777770
7777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeee6066666566666eeeeeeeeeef77777777777777777777777777777777777770
777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeef06666066666feeeeeeeeeee77777777777777777777777777777777777770
77777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee606660666660000005eeeeee7777777777777777777777777777777777770
7777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeef066077777777777d000eeeee777777777777777777777777777777777770
777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000077777777777777d000eee77777777777777777777777777777777770
77777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00665777777777777777776500e7777777777777777777777777777777770
77777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00766666777777777777777777d07777777777777777777777777777777770
7777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0067fd06777777777777777777770777777777777777777777777777777770
777777777777777760777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0167660d777777777777777777776077777777777777777777777777777770
7777777777777f7f7f007777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee06d6077777777777777777777777600777777777777777777777777777770
77777777777777efff7d017777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0dd6577777777777777777777777777000777777777777777777777777770
7777777777777ff777f7f00677777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee01656677777777777777777777777777770007777777777777777777777770
77777777777777fffff7fff00777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee01d666677777777777777777777777777777760117777777777777777777770
77777777777777ff7fff7fff0057eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee066766d00d77777777777777777777777777777755077777777777777777770
777777777777777fff7ffff77f00eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee066667000777777777777777777777777777777776511777777777777777770
7777777777777f7ff7f77e7ff7f500eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee066665057777777777777777777777777777777777775117777777777777770
77777777777777f7f7ffff7fff7ff00eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee506600677777777777777777777777777777777777777715177777777777770
7777777777777eee77fffffff7f7f7d00eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee40007dd7777777777777777777777777777777777777777777777777777770
7777777777777f17f7fffff7fffffff7004eeeeeeeeeeeeeee50000004eeeeeeeee0667550777777777777777777777777777777777777777777777777777770
77777777777777750f7ff77f7fff7ffff700eeeeeeeeee400000fff7f0eeeeeeeee0667dd0777777777777777777777777677777777777777777777777777770
777777777777777ff00f77fe7ffffffffff500eeeee40006ff7ff7fff50eeeeeeee0667600077777777777777777777777777777777777777777777777777770
7777777777777ff777f577fffff7fff7ff7f7000e050ffff7f7fffffff00eeeeeee07670000d7777777777777777777777777777777777777777777777777770
7777777777777f7ffff7760eff7ffff7ff7ffff001fff7fffffff7fff7f01eeeeee1005077777777777777777777777777777777711577777777777777777770
77777777777777fff77f77f00ffff7f77f77ff7ff7ff7ff7f7ffffff7fff0eeeeeeee00777777777777777777777777777777777776101177f77777777777770
7777777777777f77f7f77f7fe10ffffffffff7f7ffff777fff77777fff7ff0eeeeeeee170d777777777777777777777777777777777777710777777777777770
7777777777777f7ff7f7f7ff7fe017ffffff77fffff7f77ffffff7ffff7fff0eeeeee0d771007777777777777777777777777777777777777777777777777770
777777777777777ffff77f7fffff50ffffff7f7f77fff7ffffffff00fffff7f0eeeeed0770007777777777777777777777777777777777777777777777777770
7777777777777f77fffffff7ffffffff7fff0ffffffff7f7f7f77f000fffff760eeeee0001077777777777777777777777777777777777777777777777777770
7777777777777fffffffffffffffffff7ff05f7f7f777fff7ffff700007fff77f0eeeeeee5d57777777777777777777777777777777777777777777777777770
777777777777700017ffffffffffffff7f707fff77ffffff7ffffd00e007f7fff0eeeeeeed76566771000000005d011000167777777777777777777777777770
7777777777777d00006ffff7fff77fff77ffffff77f7f7fff7f7f00eee000ffffdeeeeeee0165000000000000000000000000000057777777777777777777770
777777777777777100007ffffffffffffffff7ffff7ff77f7f7ff0000666d0ff7f0eeeeee0650eeeeeeeeeeeeeeeeeeeeeef7000000000007777777777777770
777777777777777770000057fff777ffffff7f7ff7f777fff7ff51666666605f7f0eeeeeee00eeeeeeeeeeeeeeeeeeeeeee77777775000000777777777777770
7777777777777777777000000ff7ff7fffff7ffff7ff7fffff5566666666660fff5eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777d0677777777777770
777777777777777777777000000fff7ffff7777fffffff7f50066666666666d0fff0eeeeeeeeeeeeeeeeeeeeeeeeeeeeeef77777777777777f77777777777770
77777777777777777777777000000fffff77ffffffff7f000005666666666660fff0eeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777770
777777777777777777777777750005e050fff7fffff000000f706666666666660ff5eeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777770
7777777777777777777777777eee100007f7fffffffff0d7fff06666666666660fff0eeeeeeeeeeeeeeeeeeeeeeeeeeee7777777777777777777777777777770
77777777777777777777777777eeee00fff7fff7fffff777fff066666665000d00ff0eeeeeeeeeeeeeeeeeeeeeeeeeeee7777777777777777777777777777770
77777777777777777777777777eeeee0ff7f7ffff7f7ffff77705500d56666660e001eeeeeeeeeeeeeeeeeeeeeeeeeeef7777777777777777777777777777770
77777777777777777777777777eeeee06fff7fff77fff7fff7f06666666666660eeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777777777777777777777777770
777777777777777777777777777eeeee07ff7f7777ffffffff706666666666660eeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777777777777777777777777770
777777777777777777777777777eeeee0fff7ff77fffff7ff7f06666666666660eeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777777770
7777777777777777777777777777eeee0dfff7f777f777ff7ff06666666666500eeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777777770
7777777777777777777777777777eeeee00000050000000000005666650006660eeeeeeeeeeeeeeeeeeeeeeeeeeeee7777777777777777777777777777777770
77777777777777777777777777777eeeeeeeeeeeee40000011000000666666660eeeeeeeeeeeeeeeeeeeeeeeeeeeef7777777777777777777777777777777770
77777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeee0666666666660eeeeeeeeeeeeeeeeeeeeeeeeeeee77777777777777777777777777777777770
777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeee0666666666660eeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777777777770
7777777777777777777777777777777eeeeeeeeeeeeeeeeeeeee0666666665000eeeeeeeeeeeeeeeeeeeeeeeeee7777777777777777777777777777777777770
7777777777777777777777777777777feeeeeeeeeeeeeeeeeeee0666d0000004eeeeeeeeeeeeeeeeeeeeeeeeee77777777777777777777777777777777777770
77777777777777777777777777777777eeeeeeeeeeeeeeeeeeee0000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeef77777777777777777777777777777777777770
777777777777777777777777777777777eeeeeeeeeeeeeeeeeee5005eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee7777777777777777777777777777777777777770
7777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeef7777777777777777777777777777777777777770
77777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777777777777777770
777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee7777777777777777777777777777777777777777770
7777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777777777777777777777777777777777777770
77777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777777777777777777770
777777777777777777777777777777777777777feeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777777777777777777777770
777777777777777777777777777777777777777777feeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee77777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777feeeeeeeeeeeeeeeeeeeeeeeeeeeeeee7777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeeeeeeeee777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777eeeeeeeeeeeeeeeeeeeee777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777feeeeeeeeeeeef7777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777770
77777777777777776000057777000000000000007777777000000777777777777777000000000777777777700006777700000057770000077777777777777770
777777777777777000000000770000000000000077777000000000077777777777000000000000d7777777700006777000000077100000000777777777777770
77777777777777000000000077000000000000007777000000000000577777777000000000000000777777700006770000000776000000000777777777777770
777777777777770000000000770000000000000077700000000000000d77777700000000000000000777777000077d0000007770000000000777777777777770
77777777777770000007000777777770000777777770000000000000007777700000000d710000000677777000077000000777700000dd000777777777777770
77777777777770000077771777777770000777777770000077777000005777700000077777770000007777700007000000177760000577767777777777777770
77777777777770000077777777777770000777777770000077777700000777000000777777777000006777700000000001777770000577777777777777777770
77777777777775000007777777777770000777777770000077777700000777000007777777777500000777700000000007777770000077777777777777777770
7777777777777700000077777777777000077777777000007777775000077700000777777777770000077770000000007777777000000d777777777777777770
77777777777777600000057777777770000777777770000077777700000777000007777777777700000777700000000777777777000000077777777777777770
777777777777777d0000005777777770000777777770000077777700000777000007777777777700000777700000000777777777700000007777777777777770
77777777777777777000000577777770000777777770000077777000000777000007777777777700000777700000000177777777770000000777777777777770
77777777777777777700000077777770000777777770000077750000007777000007777777777700000777700000000077777777777600000777777777777770
77777777777777777770000077777770000777777770000000000000017777000000777777777000000777700000000007777777777760000077777777777770
77777777777777777777000057777770000777777770000000000000077777700000077777770000007777700007000000777777777770000077777777777770
7777777777777700777700005777777000077777777000000000000177777770000000777750000000777770000770000007777d077770000077777777777770
777777777777700000000000777777700007777777700000000005777777777700000000000000000777777000077000000d7700000000000d77777777777770
77777777777770000000000077777770000677777770000077777777777777777000000000000000777777700007770000007700000000000777777777777770
77777777777700000000000777777770000d77777770000077777777777777777700000000000007777777700007777000000750000000005777777777777770
77777777777777000000007777777770000d7777777000007777777777777777777600000000067777777770000777770000007d0000000d7777777777777770
77777777777777771000777777777775555777777770000077777777777777777777775000d777777777777555577777000005d77d000d7777777aaccbb99cc0
777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777aaccbb99cc0

